# app.py
import streamlit as st
# ‡§Ö‡§™‡§®‡•Ä ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§≤‡•â‡§ú‡§ø‡§ï ‡§´‡§æ‡§á‡§≤ ‡§∏‡•á ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§ú ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
from logic_engine import AvacchedakaEngine, PanchavayavaReasoning, PaniniNLPSimulator

# --- ‡§™‡•á‡§ú ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ---
st.set_page_config(
    page_title="Navya-AI Engine",
    page_icon="üß†",
    layout="wide"
)

# --- ‡§™‡•ç‡§∞‡•ã‡§´‡•á‡§∂‡§®‡§≤ UI ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∏‡•ç‡§ü‡§Æ CSS [span_14](start_span)[span_14](end_span) ---
# ‡§Ø‡§π ‡§Ü‡§™‡§ï‡•á ‡§ê‡§™ ‡§ï‡•ã ‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à
st.markdown("""
<style>
   .main-header {font-size: 2.5rem; color: #4A148C; text-align: center; font-weight: bold;}
   .sub-header {font-size: 1.5rem; color: #6A1B9A; margin-top: 20px;}
   .success-box {padding: 15px; background-color: #E8F5E9; border-left: 5px solid #2E7D32; border-radius: 5px;}
   .logic-box {padding: 15px; background-color: #F3E5F5; border-left: 5px solid #8E24AA; border-radius: 5px; margin-bottom: 10px;}
</style>
""", unsafe_allow_html=True)

# --- ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§Ö‡§®‡•Å‡§≠‡§æ‡§ó ---
st.markdown('<div class="main-header">Navya-XAI: ‡§®‡•à‡§§‡§ø‡§ï AI ‡§¢‡§æ‡§Ç‡§ö‡§æ</div>', unsafe_allow_html=True)
st.markdown("### ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§§‡§∞‡•ç‡§ï‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ (‡§®‡§µ‡•ç‡§Ø-‡§®‡•ç‡§Ø‡§æ‡§Ø) ‡§î‡§∞ ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§ó‡§£‡§®‡§æ ‡§ï‡§æ ‡§è‡§ï‡•Ä‡§ï‡§∞‡§£")
st.markdown("---")

# --- ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ [span_16](start_span)[span_16](end_span) ---
st.sidebar.title("Navya-OS ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤‡•ç‡§∏")
module = st.sidebar.radio(
    "‡§≤‡•â‡§ú‡§ø‡§ï ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç:",
    ["1. ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§á‡§Ç‡§ú‡§® (Avacchedaka)", "2. ‡§§‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ú‡§® (Panchavayava)", "3. ‡§®‡§ø‡§Ø‡§§‡§æ‡§§‡•ç‡§Æ‡§ï NLP (Panini)"]
)

# =================================================================================
# ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 1: ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§á‡§Ç‡§ú‡§® (‡§Ö‡§∏‡•ç‡§™‡§∑‡•ç‡§ü‡§§‡§æ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡§®‡§æ)
# =================================================================================
if module == "1. ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§á‡§Ç‡§ú‡§® (Avacchedaka)":
    st.markdown('<div class="sub-header">‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 1: ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§á‡§Ç‡§ú‡§® (The Context Engine)</div>', unsafe_allow_html=True)
    st.info("‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡§≤: '‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Ö‡§Ç‡§ß‡§æ‡§™‡§®' (Context Blindness)‡•§ ‡§Ø‡§π ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§∞‡•ç‡§•‡•ã‡§Ç ‡§ï‡•ã ‡§†‡•Ä‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§µ‡§ö‡•ç‡§õ‡•á‡§¶‡§ï (Delimiter) ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("### ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§á‡§®‡§™‡•Å‡§ü")
        # ‡§∂‡§¨‡•ç‡§¶ ‡§ö‡§Ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§®
        word = st.selectbox("‡§è‡§ï ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ (‡§™‡§¶‡§æ‡§∞‡•ç‡§•) ‡§ö‡•Å‡§®‡•á‡§Ç:",)
        
        # ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ó‡§§‡§ø‡§∂‡•Ä‡§≤ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§ö‡§Ø‡§®
        engine = AvacchedakaEngine()
        # ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§π‡§Æ ‡§ï‡•á‡§µ‡§≤ ‡§â‡§∏ ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§π‡•Ä ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
        if word in engine.knowledge_base:
            available_contexts = list(engine.knowledge_base[word].keys())
        else:
        
        context = st.selectbox("‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ (‡§Ö‡§µ‡§ö‡•ç‡§õ‡•á‡§¶‡§ï) ‡§ö‡•Å‡§®‡•á‡§Ç:", available_contexts)
        if st.button("‡§Ö‡§∞‡•ç‡§• ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (Resolve Meaning)"):
            result = engine.resolve_meaning(word, context)
            st.session_state['context_result'] = result
    with col2:
        st.markdown("### AI ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü (‡§®‡§µ‡•ç‡§Ø-‡§≤‡•â‡§ú‡§ø‡§ï)")
        if 'context_result' in st.session_state:
            st.markdown(f"""
            <div class="success-box">
                <b>‡§∂‡§¨‡•ç‡§¶:</b> {word}<br>
                <b>‡§∏‡•Ä‡§Æ‡§æ‡§Ç‡§ï‡§ï (Avacchedaka):</b> {context}<br>
                <b>‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§Ö‡§∞‡•ç‡§• (Avacchinna):</b><br>
                <h2>{st.session_state['context_result']}</h2>
            </div>
            """, unsafe_allow_html=True)
            
            # ‡§∏‡•à‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§‡§ø‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ
            st.markdown("#### ‡§Ø‡§π ‡§¨‡•á‡§π‡§§‡§∞ ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§π‡•à?")
            st.write("‡§è‡§ï ‡§Æ‡§æ‡§®‡§ï LLM ‡§™‡•ç‡§∞‡§æ‡§Ø‡§ø‡§ï‡§§‡§æ (Probability) ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§¶‡§ø ‡§Ü‡§™ '‡§ü‡§æ‡§á‡§ó‡§∞' ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§µ‡§π 60% ‡§™‡§∂‡•Å, 40% ‡§ñ‡•á‡§≤ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§≤‡§ó‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä *‡§§‡§æ‡§∞‡•ç‡§ï‡§ø‡§ï ‡§≤‡•â‡§ï (Logical Lock)* ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ö‡§∞‡•ç‡§• ‡§ï‡•ã ‡§ö‡•Å‡§®‡•á ‡§π‡•Å‡§è ‡§∏‡•Ä‡§Æ‡§æ‡§Ç‡§ï‡§ï ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§ñ‡•ç‡§§‡•Ä ‡§∏‡•á ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á 100% ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§")

# =================================================================================
# ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 2: ‡§§‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ú‡§® (‡§¨‡•ç‡§≤‡•à‡§ï ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡§®‡§æ)
# =================================================================================
elif module == "2. ‡§§‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ú‡§® (Panchavayava)":
    st.markdown('<div class="sub-header">‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 2: ‡§§‡§∞‡•ç‡§ï ‡§á‡§Ç‡§ú‡§® (The Reasoning Engine)</div>', unsafe_allow_html=True)
    st.info("‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡§≤: '‡§¨‡•ç‡§≤‡•à‡§ï ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø'‡•§ ‡§Ø‡§π ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ AI ‡§ï‡•ã 5-‡§ö‡§∞‡§£‡•Ä‡§Ø ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§®‡•ç‡§Ø‡§æ‡§Ø‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•á ‡§®‡§ø‡§∑‡•ç‡§ï‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§∏‡§æ‡§¨‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§æ‡§ß‡•ç‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§")
    
    # ‡§ã‡§£ ‡§°‡•á‡§ü‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§®‡§™‡•Å‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ
    with st.form("loan_form"):
        st.markdown("### ‡§ã‡§£ ‡§Ü‡§µ‡•á‡§¶‡§® ‡§°‡•á‡§ü‡§æ")
        col1, col2 = st.columns(2)
        with col1:
            name = st.text_input("‡§Ü‡§µ‡•á‡§¶‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ", "Rajiv Sharma")
            income = st.number_input("‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§Ü‡§Ø (‚Çπ)", value=500000)
            job_years = st.slider("‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§®‡•å‡§ï‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§∑", 0, 20, 3)
        with col2:
            credit_score = st.slider("‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§∏‡•ç‡§ï‡•ã‡§∞", 300, 900, 680)
            guarantor = st.checkbox("‡§ï‡•ç‡§Ø‡§æ ‡§™‡§æ‡§∞‡§ø‡§µ‡§æ‡§∞‡§ø‡§ï/‡§ó‡§æ‡§∞‡§Ç‡§ü‡§∞ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§π‡•à?", value=True)
            
        submit = st.form_submit_button("‡§™‡§Ç‡§ö‡§æ‡§µ‡§Ø‡§µ ‡§§‡§∞‡•ç‡§ï ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç")
        
    if submit:
        # ‡§∞‡•Ä‡§ú‡§®‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§ú‡§® ‡§ï‡•ã ‡§á‡§Ç‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü‡§ø‡§è‡§ü ‡§ï‡§∞‡•á‡§Ç
        nyaya = PanchavayavaReasoning(name)
        logic_trace = nyaya.evaluate_loan(credit_score, job_years, income, guarantor)
        
        st.markdown("### 5-‡§ö‡§∞‡§£‡•Ä‡§Ø ‡§§‡§æ‡§∞‡•ç‡§ï‡§ø‡§ï ‡§ü‡•ç‡§∞‡•á‡§∏ (The 5-Step Logical Trace)")
        
        # 5 ‡§ö‡§∞‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ
        for step, content in logic_trace.items():
            st.markdown(f"""
            <div class="logic-box">
                <b>{step}</b><br>
                {content}
            </div>
            """, unsafe_allow_html=True)
            
        if "‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§" in logic_trace:
            st.balloons()
        else:
            st.error("‡§§‡§∞‡•ç‡§ï ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§Ü‡§µ‡•á‡§¶‡§® ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§‡•§")

# =================================================================================
# ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 3: ‡§®‡§ø‡§Ø‡§§‡§æ‡§§‡•ç‡§Æ‡§ï NLP (‡§π‡•à‡§≤‡•Å‡§∏‡§ø‡§®‡•á‡§∂‡§® ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡§®‡§æ)
# =================================================================================
elif module == "3. ‡§®‡§ø‡§Ø‡§§‡§æ‡§§‡•ç‡§Æ‡§ï NLP (Panini)":
    st.markdown('<div class="sub-header">‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ 3: ‡§™‡§æ‡§£‡§ø‡§®‡•Ä‡§Ø ‡§®‡§ø‡§Ø‡§§‡§æ‡§§‡•ç‡§Æ‡§ï NLP</div>', unsafe_allow_html=True)
    st.info("‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡§≤: '‡§π‡•à‡§≤‡•Å‡§∏‡§ø‡§®‡•á‡§∂‡§®' (Hallucination)‡•§ ‡§™‡§æ‡§£‡§ø‡§®‡•Ä ‡§ï‡•á ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á, ‡§π‡§Æ ‡§ó‡§£‡§ø‡§§‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∂‡§¨‡•ç‡§¶ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§ï‡•ã‡§à ‡§®‡§ø‡§Ø‡§Æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§§‡•ã ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ù‡•Ç‡§† ‡§¨‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ö‡•Å‡§™ ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("### ‡§è‡§ï ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡•á‡§Ç")
        dhatu = st.selectbox("‡§Æ‡•Ç‡§≤ (‡§ß‡§æ‡§§‡•Å) ‡§ö‡•Å‡§®‡•á‡§Ç:", ["Path", "Gam", "Likha"])
        pratyaya = st.selectbox("‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§Ø (Suffix) ‡§ö‡•Å‡§®‡•á‡§Ç:",)
        
        if st.button("‡§∂‡§¨‡•ç‡§¶ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç (Generate Word)"):
            panini = PaniniNLPSimulator()
            word_result = panini.generate_word(dhatu, pratyaya)
            st.session_state['panini_result'] = word_result
            
    with col2:
        st.markdown("### ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ")
        if 'panini_result' in st.session_state:
            if "‡§§‡•ç‡§∞‡•Å‡§ü‡§ø" in st.session_state['panini_result']:
                st.warning(st.session_state['panini_result'])
            else:
                st.success(f"‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§∂‡§¨‡•ç‡§¶: *{st.session_state['panini_result']}*")
                
            st.markdown("#### ‡§è‡§≤‡•ç‡§ó‡•ã‡§∞‡§ø‡§¶‡§Æ (The Algorithm):")
            st.code(f"IF Dhatu == '{dhatu}' AND Pratyaya == '{pratyaya}':\n    RETURN Result\nELSE:\n    BLOCK Output (Prevent Hallucination)")

# ‡§´‡•Å‡§ü‡§∞ (Footer) - 'Made with Streamlit' ‡§ï‡•ã ‡§õ‡§ø‡§™‡§æ‡§®‡•á ‡§î‡§∞ ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è [span_17](start_span)[span_17](end_span)
hide_st_style = """
            <style>
            #MainMenu {visibility: hidden;}
            footer {visibility: hidden;}
            header {visibility: hidden;}
            </style>
            """
st.markdown(hide_st_style, unsafe_allow_html=True)
